<!DOCTYPE html>
<html lang="uk" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>–ü—Ä–æ—Ñ—ñ–ª—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞</title>
    <link rel="stylesheet" th:href="@{/css/profile.css}">
    <link rel="stylesheet" th:href="@{/css/home.css}">
    <script th:src="@{/js/enum-translator.js}"></script>
    <script th:src="@{/js/apply-translations.js}"></script>
</head>
<body>
<header th:replace="~{fragments/layout :: header-auth(${userRole})}"></header>

<section id="profile-section">

    <div class="profile-card profile-main-info">

        <div class="profile-left">
            <img th:src="${user.profilePictureUrl != null ? user.profilePictureUrl : '/images/default-avatar.png'}"
                 alt="–§–æ—Ç–æ –ø—Ä–æ—Ñ—ñ–ª—é" class="profile-photo">

            <span class="profile-role" th:attr="data-role=${userRole}" th:text="${userRole}">Role</span>
            <h2 class="profile-name" th:text="${user.fullName}">–ü–æ–≤–Ω–µ —ñ–º'—è</h2>

            <p th:if="${userRole == 'DOCTOR'}" class="profile-description"
               th:text="${user.description != null ? user.description : '–û–ø–∏—Å –≤—ñ–¥—Å—É—Ç–Ω—ñ–π'}">
                –û–ø–∏—Å –ª—ñ–∫–∞—Ä—è.
            </p>
        </div>

        <div class="profile-info">
            <h3 class="info-title">–û—Å–æ–±–∏—Å—Ç—ñ –¥–∞–Ω—ñ</h3>

            <div class="profile-info-grid">

                <div class="info-item">
                    <span class="label">–î–∞—Ç–∞ –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è:</span>
                    <span class="value" th:text="${user.dateOfBirth}"></span>
                </div>

                <div class="info-item" data-field-name="email" data-field-type="email">
                    <span class="label">Email:</span>
                    <div class="editable-field">
                        <span class="value" th:text="${user.email}">example@com.hihi</span>
                        <input class="edit-input hidden" type="email" th:value="${user.email}">
                        <button class="edit-icon" type="button">üìù</button>
                        <button class="save-icon hidden" type="button">üíæ</button>
                    </div>
                </div>

                <div class="info-item" data-field-name="phoneNumber" data-field-type="tel">
                    <span class="label">–¢–µ–ª–µ—Ñ–æ–Ω:</span>
                    <div class="editable-field">
                        <span class="value" th:text="${user.phoneNumber}">+380501234567</span>
                        <input class="edit-input hidden" type="tel" th:value="${user.phoneNumber}" pattern="\+380[0-9]{9}">
                        <button class="edit-icon" type="button">üìù</button>
                        <button class="save-icon hidden" type="button">üíæ</button>
                    </div>
                </div>

                <div class="info-item">
                    <span class="label">–ù–æ–º–µ—Ä –ø–∞—Å–ø–æ—Ä—Ç–∞:</span>
                    <span class="value" th:text="${user.passportNumber}"></span>
                </div>

                <th:block th:if="${userRole == 'DOCTOR' or userRole == 'LAB_ASSISTANT'}">
                    <div class="info-item">
                        <span class="label">–õ—ñ–∫–∞—Ä–Ω—è:</span>
                        <span class="value" th:text="${user.hospitalName}"></span>
                    </div>
                </th:block>

                <th:block th:if="${userRole == 'DOCTOR'}">
                    <div class="info-item">
                        <span class="label">–°–ø–µ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è:</span>
                        <span class="value" th:text="${user.doctorType}"></span>
                    </div>
                </th:block>

                <th:block th:if="${userRole == 'PATIENT'}">
                    <div class="info-item">
                        <span class="label">–°—ñ–º–µ–π–Ω–∏–π –ª—ñ–∫–∞—Ä:</span>
                        <span class="value">
                            <a th:if="${user.familyDoctorName}" 
                            th:href="@{/ui/public/doctors/{id}(id=${user.familyDoctorId})}"
                            th:text="${user.familyDoctorName}">
                            </a>

                            <span th:unless="${user.familyDoctorName}" class="unspecified">‚Äî –î–µ–∫–ª–∞—Ä–∞—Ü—ñ—è –≤—ñ–¥—Å—É—Ç–Ω—è</span>
                        </span>
                    </div>
                </th:block>

            </div>

        </div>

        <div class="profile-right">

            <a th:if="${userRole == 'DOCTOR' or userRole == 'LAB_ASSISTANT'}"
               th:href="@{/ui/calendar}" class="profile-button secondary-button">
                –†–æ–∑–∫–ª–∞–¥ (–¥–µ–Ω—å/—Ç–∏–∂–¥–µ–Ω—å)
            </a>

            <a th:if="${userRole == 'PATIENT'}"
               th:href="@{/ui/referrals/{id}(id=${user.profileId})}" class="profile-button secondary-button">
                –ê–∫—Ç–∏–≤–Ω—ñ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—è
            </a>

            <a th:if="${userRole == 'PATIENT'}"
               th:href="@{/ui/history/{patientId}(patientId=${user.getProfileId()})}"
               class="profile-button secondary-button">
                –Ü—Å—Ç–æ—Ä—ñ—è —Ö–≤–æ—Ä–æ–±–∏
            </a>

        </div>
    </div>

    <div th:if="${userRole == 'PATIENT'}" class="profile-card appointments-card">

        <h3 class="info-title">–ó–∞–ø–ª–∞–Ω–æ–≤–∞–Ω—ñ –∑–∞–ø–∏—Å–∏</h3>

        <div class="appointments-list">
            <a th:each="appt : ${plannedAppointments}" 
               th:href="@{/ui/appointments/{id}(id=${appt.id})}"
               class="appointment-item"
               style="text-decoration: none; color: inherit; display: flex; justify-content: space-between; align-items: center; padding: 12px; border-radius: 8px; transition: background-color 0.2s;">

        <span th:if="${appt.doctorName != null}" style="flex: 1;">
            <span th:text="|${appt.date} –æ ${appt.time} - ${appt.doctorName}|"></span>
            <span th:if="${appt.examinationName}"
                  th:text="| (${appt.examinationName})|">
            </span>
        </span>

                <span th:unless="${appt.doctorName != null}" style="flex: 1;">
            <span th:text="|${appt.date} –æ ${appt.time} - ${appt.examinationName}|"></span>
        </span>
                
                <span style="background: #e6f7ff; color: #4facfe; padding: 6px 12px; border-radius: 6px; font-size: 14px; font-weight: 500; white-space: nowrap;">–ë—ñ–ª—å—à–µ ‚Üí</span>
            </a>
            <p th:if="${#lists.isEmpty(plannedAppointments)}">–ù–µ–º–∞—î –∑–∞–ø–ª–∞–Ω–æ–≤–∞–Ω–∏—Ö –∑–∞–ø–∏—Å—ñ–≤.</p>
        </div>

    </div>

</section>

<div id="reminder-modal" class="modal hidden">
    <form class="modal-content">
        <h3>–í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –Ω–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è</h3>
        <label for="reminderTime">–ù–∞–¥—ñ—Å–ª–∞—Ç–∏ –∑–∞:</label>
        <select id="reminderTime" name="reminderTime">
            <option value="10">10 —Ö–≤–∏–ª–∏–Ω</option>
            <option value="30">30 —Ö–≤–∏–ª–∏–Ω</option>
            <option value="60">1 –≥–æ–¥–∏–Ω—É</option>
            <option value="1440">1 –¥–µ–Ω—å</option>
        </select>
        <button type="submit" class="profile-button primary-button">–ó–±–µ—Ä–µ–≥—Ç–∏</button>
        <button type="button" id="close-modal" class="profile-button secondary-button">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
    </form>
</div>

<footer th:replace="~{fragments/layout :: footer-auth(${userRole})}"></footer>

<script th:src="@{/js/profile.js}"></script>
</body>
</html>